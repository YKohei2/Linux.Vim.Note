{"changed":true,"filter":false,"title":"AWS.note","tooltip":"/AWS.note","value":"踏み台サーバの作成接続\n1.VPC作成\n2.サブネット作成\n3.インターネットゲートウェイ作成\n4.ルートテーブル作成 (インターネットゲートウェイに向けてルートを設定する)\n5.ルートテーブルをサブネットにアタッチ\n6.パブリック用EC2インスタンス作成\n7.セキュリティグループ作成 (SSH接続できるようインバウンドに22を許可する)\n8.セキュリティグループをEC2にアタッチ\n9.EC2にSSH接続\n10.Elastic IP作成\n11.Elastic IPをEC2にアタッチ\n12.プライベートEC2インスタンス作成\n13.パブリックEC2からプライベートEC2に接続\n  1 キーペアをパブリックec2に繋がっているtera termにドラックドロップ\n  2 chmodでキーペアファイルの権限を700に変更 ($ chmod 700 キーペアファイル名) \n  3 ssh -i rsa.pem(キーペア名)ec2-user@10.0.1.143(プライベートIPアドレス)これで踏み台サーバを使ってプライベートインスタンスに接続完了\n14.NATゲートウェイ作成\n15.プライベートサブネットのルートテーブル作成でNATゲートウェイにつなげる(デフォルトのローカル接続はそのままで,0.0.0.0/0でNATゲートウェイに接続)\n\n\n削除手順：\n1.EC2削除\n2.NATゲートウェイ削除\n3.ElasticIP削除\nピアリング削除\n5.VPC削除\n\n\n◎VPCピアリング作成接続　（２つのVPC内のプライベートインスタンス同士の接続), Ping通信確認\n0.接続先のVPC,サブネット、ルートテーブル,EC2作成\n1.VPCピアリングを作成\n  1.リクエスト側のVPCとその先のVPCを選択\n  2.コンソール画面、ピアリングトップページでアクションから承諾を押す\n2.リクエスト元と2つ目のVPC内にあるサブネットのルートテーブルをVPCピアリング(お互いのCIDRマスク)に向けるよう追加\n3.3つ目のEC2のセキュリティグループのインバウンドにすべてのICMP iPv44を選択してPING通信をできるようにする.\n4.１つ目のVPC内のプライベートEC2インスタンスから$ping (相手先のIPアドレス)でPingの確認ができる\n\nーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー\n\nAWS CLI インストール、設定方法 手順  Linux\n$ curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\n$ curl -o awscliv2.sig https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip.sig(最新バージョン)\n$ gpg --verify awscliv2.sig awscliv2.zip（署名検証)\n$ unzip awscliv2.zip (zipフォルダ解凍)\n$ sudo ./aws/install (インストールプログラム実行)\n$ ./aws/install -i /usr/local/aws-cli -b /usr/local/bin (パスの指定)\n$ aws --version (確認)\n\n$ AWS configure --profile ec2-user (設定) profileをつけることでユーザー名を追加できる。\nAWS Access Key ID: IAM → ユーザー → 認証情報 → アクセスキー作成\nAWS Secret Access Key:  IAM → ユーザー → 認証情報 → アクセスキー作成 ここで適当なユーザー情報を入れると権限がないのでコマンドを実行できない\nDefault region name: ap-northeast-1\nDefault output format: 記入なしでもOk. Jsonになる\nprofileでユーザーの情報を入れた後はcredentials, config内のデフォルト情報は消すようにする\n\n消した後はコマンドの末尾に --profile ec2-user(ユーザー名)をつけないと権限がないので見れない\n\n.awsのディレクトリの中config と credentialに AWS access key ID, AWS secret access keyregion, output formの設定ファイルがある\n\nAWS CLIコマンド\n$ aws help コマンド確認 \n$ aws ec2 help  ec2関連のコマンド確認\n\nコマンドにdescribeがある場合詳細を見れるコマンド\n$ aws ec2 describe-vpcs 現在あるvpcの情報\n\n後ろにつける--query Vpcs[].VpcId、vpcのid情報のみ出してくれる。[]に数字を入れると必要なものだけを出力できる。0一番上,1,2,3\n\n\n----------------------------------------------\n\nS3エンドポイント (プライベートec2インスタンスからS3に接続)\n1.プライベートec2インスタンスにNATゲートウェイでインターネット接続してAWS CLIコマンドインストール\n2.S3エンドポイント作成\n  1.VPC選択\n  2.s3検索してゲートウェイタイプを選択\n  3.プライベートサブネットに使っているルートテーブルを選択\n  \n----------------------------------------------\n\nVPC CloudWatch Flow logs作成手順\n\n1.IAMから空のロールを作成\n  とりあえずAWSのサービス,EC2にチェックして,許可ポリシーは選ばないで空のロールを作成する。\n2.先ほど作成したロールを選んでポリシーを追加する。\n  1.許可を追加からインラインポリシーを作成を選ぶ\n  2.jsonからデフォルトのjsonで記述しているものを削除して公式のVPCフローログのロールのjsonをコピーしてペーストして作成を完了する。\n  公式URL: https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/flow-logs-cwl.html\n3.ロールの信頼関係の編集\n  1.信頼ポリシーを編集\n  2.公式のjsonから引っ張てくる。（principalのserviceの部分をec2からvpcが記述されているものに変更する。)\n  3.更新ボタンを押す\n4.CloudWatchロググループを作成\n  保持期間が長いと、料金が高くなる。\n5.VPCからフローログを作成\n  - フィルタ..承諾されたトラフィックのみ保管か（失敗のみか、両方保管か)\n  - CloudWatch Logsに送信\n  - 先ほど作ったロググループとIAMロールを選択\n  - ログ形式はカスタムから属性すべてを選択するとすべての情報を入手できる。\n  \n","undoManager":{"mark":99,"position":100,"stack":[[{"start":{"row":91,"column":66},"end":{"row":92,"column":0},"action":"insert","lines":["",""],"id":888},{"start":{"row":92,"column":0},"end":{"row":92,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":92,"column":1},"end":{"row":92,"column":2},"action":"insert","lines":["3"],"id":889},{"start":{"row":92,"column":2},"end":{"row":92,"column":3},"action":"insert","lines":["."]}],[{"start":{"row":92,"column":3},"end":{"row":92,"column":11},"action":"insert","lines":["更新ボタンを押す"],"id":890},{"start":{"row":92,"column":11},"end":{"row":92,"column":12},"action":"insert","lines":[","]}],[{"start":{"row":92,"column":12},"end":{"row":93,"column":0},"action":"insert","lines":["",""],"id":891},{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"remove","lines":[" "],"id":892},{"start":{"row":92,"column":12},"end":{"row":93,"column":0},"action":"remove","lines":["",""]},{"start":{"row":92,"column":11},"end":{"row":92,"column":12},"action":"remove","lines":[","]}],[{"start":{"row":92,"column":11},"end":{"row":93,"column":0},"action":"insert","lines":["",""],"id":893},{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"insert","lines":[" "]}],[{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"remove","lines":[" "],"id":894}],[{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"insert","lines":["3"],"id":895}],[{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"remove","lines":["3"],"id":896}],[{"start":{"row":93,"column":0},"end":{"row":93,"column":1},"action":"insert","lines":["4"],"id":897},{"start":{"row":93,"column":1},"end":{"row":93,"column":2},"action":"insert","lines":["."]}],[{"start":{"row":90,"column":1},"end":{"row":90,"column":2},"action":"insert","lines":[" "],"id":898}],[{"start":{"row":91,"column":1},"end":{"row":91,"column":2},"action":"insert","lines":[" "],"id":899}],[{"start":{"row":92,"column":1},"end":{"row":92,"column":2},"action":"insert","lines":[" "],"id":900}],[{"start":{"row":81,"column":13},"end":{"row":81,"column":14},"action":"remove","lines":["t"],"id":901},{"start":{"row":81,"column":12},"end":{"row":81,"column":13},"action":"remove","lines":["n"]},{"start":{"row":81,"column":11},"end":{"row":81,"column":12},"action":"remove","lines":["o"]},{"start":{"row":81,"column":10},"end":{"row":81,"column":11},"action":"remove","lines":["r"]},{"start":{"row":81,"column":9},"end":{"row":81,"column":10},"action":"remove","lines":["F"]}],[{"start":{"row":81,"column":9},"end":{"row":81,"column":10},"action":"insert","lines":["W"],"id":902},{"start":{"row":81,"column":10},"end":{"row":81,"column":11},"action":"insert","lines":["a"]},{"start":{"row":81,"column":11},"end":{"row":81,"column":12},"action":"insert","lines":["t"]},{"start":{"row":81,"column":12},"end":{"row":81,"column":13},"action":"insert","lines":["c"]},{"start":{"row":81,"column":13},"end":{"row":81,"column":14},"action":"insert","lines":["h"]}],[{"start":{"row":93,"column":2},"end":{"row":93,"column":3},"action":"insert","lines":["g"],"id":903},{"start":{"row":93,"column":3},"end":{"row":93,"column":4},"action":"insert","lines":["i"]},{"start":{"row":93,"column":4},"end":{"row":93,"column":5},"action":"insert","lines":["t"]}],[{"start":{"row":93,"column":5},"end":{"row":93,"column":6},"action":"insert","lines":[" "],"id":904}],[{"start":{"row":93,"column":5},"end":{"row":93,"column":6},"action":"remove","lines":[" "],"id":905},{"start":{"row":93,"column":4},"end":{"row":93,"column":5},"action":"remove","lines":["t"]},{"start":{"row":93,"column":3},"end":{"row":93,"column":4},"action":"remove","lines":["i"]},{"start":{"row":93,"column":2},"end":{"row":93,"column":3},"action":"remove","lines":["g"]}],[{"start":{"row":93,"column":2},"end":{"row":93,"column":3},"action":"insert","lines":[" "],"id":906}],[{"start":{"row":93,"column":2},"end":{"row":93,"column":3},"action":"remove","lines":[" "],"id":907}],[{"start":{"row":93,"column":2},"end":{"row":93,"column":3},"action":"insert","lines":["C"],"id":908},{"start":{"row":93,"column":3},"end":{"row":93,"column":4},"action":"insert","lines":["l"]},{"start":{"row":93,"column":4},"end":{"row":93,"column":5},"action":"insert","lines":["o"]},{"start":{"row":93,"column":5},"end":{"row":93,"column":6},"action":"insert","lines":["u"]},{"start":{"row":93,"column":6},"end":{"row":93,"column":7},"action":"insert","lines":["d"]},{"start":{"row":93,"column":7},"end":{"row":93,"column":8},"action":"insert","lines":["W"]}],[{"start":{"row":93,"column":8},"end":{"row":93,"column":9},"action":"insert","lines":["a"],"id":909},{"start":{"row":93,"column":9},"end":{"row":93,"column":10},"action":"insert","lines":["t"]},{"start":{"row":93,"column":10},"end":{"row":93,"column":11},"action":"insert","lines":["c"]},{"start":{"row":93,"column":11},"end":{"row":93,"column":12},"action":"insert","lines":["h"]}],[{"start":{"row":93,"column":12},"end":{"row":93,"column":18},"action":"insert","lines":["ロググループ"],"id":910}],[{"start":{"row":93,"column":18},"end":{"row":93,"column":21},"action":"insert","lines":["を作成"],"id":911}],[{"start":{"row":93,"column":21},"end":{"row":94,"column":0},"action":"insert","lines":["",""],"id":912},{"start":{"row":94,"column":0},"end":{"row":94,"column":1},"action":"insert","lines":[" "]},{"start":{"row":94,"column":1},"end":{"row":94,"column":2},"action":"insert","lines":[" "]}],[{"start":{"row":94,"column":2},"end":{"row":94,"column":10},"action":"insert","lines":["保持期間が長いと"],"id":913}],[{"start":{"row":94,"column":10},"end":{"row":94,"column":11},"action":"insert","lines":["、"],"id":914}],[{"start":{"row":94,"column":11},"end":{"row":94,"column":18},"action":"insert","lines":["料金が高くなる"],"id":915}],[{"start":{"row":94,"column":18},"end":{"row":94,"column":19},"action":"insert","lines":["。"],"id":916}],[{"start":{"row":94,"column":19},"end":{"row":95,"column":0},"action":"insert","lines":["",""],"id":917},{"start":{"row":95,"column":0},"end":{"row":95,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":95,"column":0},"end":{"row":95,"column":2},"action":"remove","lines":["  "],"id":918}],[{"start":{"row":95,"column":0},"end":{"row":95,"column":1},"action":"insert","lines":["5"],"id":919},{"start":{"row":95,"column":1},"end":{"row":95,"column":2},"action":"insert","lines":["."]}],[{"start":{"row":95,"column":2},"end":{"row":95,"column":3},"action":"insert","lines":["V"],"id":920},{"start":{"row":95,"column":3},"end":{"row":95,"column":4},"action":"insert","lines":["P"]},{"start":{"row":95,"column":4},"end":{"row":95,"column":5},"action":"insert","lines":["C"]}],[{"start":{"row":95,"column":5},"end":{"row":95,"column":7},"action":"insert","lines":["から"],"id":921}],[{"start":{"row":95,"column":7},"end":{"row":95,"column":15},"action":"insert","lines":["フローログを作成"],"id":922}],[{"start":{"row":95,"column":15},"end":{"row":96,"column":0},"action":"insert","lines":["",""],"id":923}],[{"start":{"row":96,"column":0},"end":{"row":96,"column":1},"action":"insert","lines":[" "],"id":924},{"start":{"row":96,"column":1},"end":{"row":96,"column":2},"action":"insert","lines":[" "]},{"start":{"row":96,"column":2},"end":{"row":96,"column":3},"action":"insert","lines":["-"]}],[{"start":{"row":96,"column":3},"end":{"row":96,"column":4},"action":"insert","lines":[" "],"id":925}],[{"start":{"row":96,"column":4},"end":{"row":96,"column":9},"action":"insert","lines":["フィルアt"],"id":926}],[{"start":{"row":96,"column":8},"end":{"row":96,"column":9},"action":"remove","lines":["t"],"id":927},{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"remove","lines":["ア"]}],[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":["ル"],"id":928},{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["ィ"]},{"start":{"row":96,"column":4},"end":{"row":96,"column":5},"action":"remove","lines":["フ"]}],[{"start":{"row":96,"column":4},"end":{"row":96,"column":8},"action":"insert","lines":["フィルタ"],"id":929},{"start":{"row":96,"column":8},"end":{"row":96,"column":9},"action":"insert","lines":["."]},{"start":{"row":96,"column":9},"end":{"row":96,"column":10},"action":"insert","lines":["."]}],[{"start":{"row":96,"column":10},"end":{"row":96,"column":16},"action":"insert","lines":["トラフィック"],"id":930}],[{"start":{"row":96,"column":10},"end":{"row":96,"column":15},"action":"insert","lines":["承諾された"],"id":931}],[{"start":{"row":96,"column":21},"end":{"row":96,"column":23},"action":"insert","lines":["のみ"],"id":932}],[{"start":{"row":96,"column":23},"end":{"row":96,"column":29},"action":"insert","lines":["ログを補完か"],"id":933}],[{"start":{"row":96,"column":29},"end":{"row":96,"column":30},"action":"insert","lines":["（"],"id":934}],[{"start":{"row":96,"column":30},"end":{"row":96,"column":36},"action":"insert","lines":["h四敗のみか"],"id":935}],[{"start":{"row":96,"column":35},"end":{"row":96,"column":36},"action":"remove","lines":["か"],"id":936},{"start":{"row":96,"column":34},"end":{"row":96,"column":35},"action":"remove","lines":["み"]},{"start":{"row":96,"column":33},"end":{"row":96,"column":34},"action":"remove","lines":["の"]},{"start":{"row":96,"column":32},"end":{"row":96,"column":33},"action":"remove","lines":["敗"]},{"start":{"row":96,"column":31},"end":{"row":96,"column":32},"action":"remove","lines":["四"]},{"start":{"row":96,"column":30},"end":{"row":96,"column":31},"action":"remove","lines":["h"]}],[{"start":{"row":96,"column":30},"end":{"row":96,"column":32},"action":"insert","lines":["失敗"],"id":937},{"start":{"row":96,"column":32},"end":{"row":96,"column":35},"action":"insert","lines":["のみか"]}],[{"start":{"row":96,"column":35},"end":{"row":96,"column":36},"action":"insert","lines":["、"],"id":938}],[{"start":{"row":96,"column":36},"end":{"row":96,"column":41},"action":"insert","lines":["両方補完か"],"id":939}],[{"start":{"row":96,"column":40},"end":{"row":96,"column":41},"action":"remove","lines":["か"],"id":940},{"start":{"row":96,"column":39},"end":{"row":96,"column":40},"action":"remove","lines":["完"]},{"start":{"row":96,"column":38},"end":{"row":96,"column":39},"action":"remove","lines":["補"]}],[{"start":{"row":96,"column":38},"end":{"row":96,"column":40},"action":"insert","lines":["保管"],"id":941}],[{"start":{"row":96,"column":26},"end":{"row":96,"column":27},"action":"remove","lines":["補"],"id":942},{"start":{"row":96,"column":25},"end":{"row":96,"column":26},"action":"remove","lines":["を"]}],[{"start":{"row":96,"column":25},"end":{"row":96,"column":26},"action":"remove","lines":["完"],"id":943}],[{"start":{"row":96,"column":24},"end":{"row":96,"column":25},"action":"remove","lines":["グ"],"id":944},{"start":{"row":96,"column":23},"end":{"row":96,"column":24},"action":"remove","lines":["ロ"]}],[{"start":{"row":96,"column":23},"end":{"row":96,"column":25},"action":"insert","lines":["保管"],"id":945}],[{"start":{"row":96,"column":37},"end":{"row":96,"column":38},"action":"insert","lines":["か"],"id":946},{"start":{"row":96,"column":38},"end":{"row":96,"column":39},"action":"insert","lines":[")"]}],[{"start":{"row":96,"column":39},"end":{"row":97,"column":0},"action":"insert","lines":["",""],"id":947},{"start":{"row":97,"column":0},"end":{"row":97,"column":2},"action":"insert","lines":["  "]},{"start":{"row":97,"column":2},"end":{"row":97,"column":3},"action":"insert","lines":["-"]}],[{"start":{"row":97,"column":3},"end":{"row":97,"column":4},"action":"insert","lines":[" "],"id":948}],[{"start":{"row":97,"column":4},"end":{"row":97,"column":5},"action":"insert","lines":["C"],"id":949},{"start":{"row":97,"column":5},"end":{"row":97,"column":6},"action":"insert","lines":["l"]},{"start":{"row":97,"column":6},"end":{"row":97,"column":7},"action":"insert","lines":["o"]},{"start":{"row":97,"column":7},"end":{"row":97,"column":8},"action":"insert","lines":["u"]},{"start":{"row":97,"column":8},"end":{"row":97,"column":9},"action":"insert","lines":["d"]},{"start":{"row":97,"column":9},"end":{"row":97,"column":10},"action":"insert","lines":["W"]}],[{"start":{"row":97,"column":10},"end":{"row":97,"column":11},"action":"insert","lines":["a"],"id":950},{"start":{"row":97,"column":11},"end":{"row":97,"column":12},"action":"insert","lines":["t"]},{"start":{"row":97,"column":12},"end":{"row":97,"column":13},"action":"insert","lines":["c"]},{"start":{"row":97,"column":13},"end":{"row":97,"column":14},"action":"insert","lines":["h"]}],[{"start":{"row":97,"column":14},"end":{"row":97,"column":17},"action":"insert","lines":["ログ図"],"id":951}],[{"start":{"row":97,"column":16},"end":{"row":97,"column":17},"action":"remove","lines":["図"],"id":952},{"start":{"row":97,"column":15},"end":{"row":97,"column":16},"action":"remove","lines":["グ"]},{"start":{"row":97,"column":14},"end":{"row":97,"column":15},"action":"remove","lines":["ロ"]}],[{"start":{"row":97,"column":14},"end":{"row":97,"column":15},"action":"insert","lines":[" "],"id":953},{"start":{"row":97,"column":15},"end":{"row":97,"column":16},"action":"insert","lines":["L"]},{"start":{"row":97,"column":16},"end":{"row":97,"column":17},"action":"insert","lines":["o"]},{"start":{"row":97,"column":17},"end":{"row":97,"column":18},"action":"insert","lines":["g"]},{"start":{"row":97,"column":18},"end":{"row":97,"column":19},"action":"insert","lines":["s"]}],[{"start":{"row":97,"column":19},"end":{"row":97,"column":22},"action":"insert","lines":["に送信"],"id":954}],[{"start":{"row":97,"column":22},"end":{"row":98,"column":0},"action":"insert","lines":["",""],"id":955},{"start":{"row":98,"column":0},"end":{"row":98,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":98,"column":2},"end":{"row":98,"column":3},"action":"insert","lines":["-"],"id":956}],[{"start":{"row":98,"column":3},"end":{"row":98,"column":4},"action":"insert","lines":[" "],"id":957}],[{"start":{"row":98,"column":4},"end":{"row":98,"column":7},"action":"insert","lines":["先ほど"],"id":958}],[{"start":{"row":98,"column":7},"end":{"row":98,"column":10},"action":"insert","lines":["作った"],"id":959}],[{"start":{"row":98,"column":10},"end":{"row":98,"column":16},"action":"insert","lines":["ロググループ"],"id":960},{"start":{"row":98,"column":16},"end":{"row":98,"column":17},"action":"insert","lines":["と"]}],[{"start":{"row":98,"column":17},"end":{"row":98,"column":18},"action":"insert","lines":["I"],"id":961},{"start":{"row":98,"column":18},"end":{"row":98,"column":19},"action":"insert","lines":["A"]},{"start":{"row":98,"column":19},"end":{"row":98,"column":20},"action":"insert","lines":["M"]}],[{"start":{"row":98,"column":20},"end":{"row":98,"column":26},"action":"insert","lines":["ロールを選択"],"id":962}],[{"start":{"row":98,"column":26},"end":{"row":99,"column":0},"action":"insert","lines":["",""],"id":963},{"start":{"row":99,"column":0},"end":{"row":99,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":99,"column":0},"end":{"row":100,"column":0},"action":"remove","lines":["  ",""],"id":964}],[{"start":{"row":99,"column":1},"end":{"row":99,"column":2},"action":"insert","lines":["-"],"id":965}],[{"start":{"row":99,"column":1},"end":{"row":99,"column":2},"action":"insert","lines":[" "],"id":966}],[{"start":{"row":99,"column":3},"end":{"row":99,"column":4},"action":"insert","lines":["r"],"id":967}],[{"start":{"row":99,"column":4},"end":{"row":99,"column":5},"action":"insert","lines":["o"],"id":968}],[{"start":{"row":99,"column":5},"end":{"row":99,"column":9},"action":"insert","lines":["具形式は"],"id":969}],[{"start":{"row":99,"column":8},"end":{"row":99,"column":9},"action":"remove","lines":["は"],"id":970},{"start":{"row":99,"column":7},"end":{"row":99,"column":8},"action":"remove","lines":["式"]},{"start":{"row":99,"column":6},"end":{"row":99,"column":7},"action":"remove","lines":["形"]},{"start":{"row":99,"column":5},"end":{"row":99,"column":6},"action":"remove","lines":["具"]},{"start":{"row":99,"column":4},"end":{"row":99,"column":5},"action":"remove","lines":["o"]},{"start":{"row":99,"column":3},"end":{"row":99,"column":4},"action":"remove","lines":["r"]}],[{"start":{"row":99,"column":3},"end":{"row":99,"column":5},"action":"insert","lines":["ログ"],"id":971}],[{"start":{"row":99,"column":3},"end":{"row":99,"column":4},"action":"insert","lines":[" "],"id":972}],[{"start":{"row":99,"column":6},"end":{"row":99,"column":8},"action":"insert","lines":["形式"],"id":973},{"start":{"row":99,"column":8},"end":{"row":99,"column":9},"action":"insert","lines":["は"]}],[{"start":{"row":99,"column":9},"end":{"row":99,"column":15},"action":"insert","lines":["カスタムから"],"id":974}],[{"start":{"row":99,"column":15},"end":{"row":99,"column":17},"action":"insert","lines":["属性"],"id":975}],[{"start":{"row":99,"column":17},"end":{"row":99,"column":26},"action":"insert","lines":["すべてを選択すると"],"id":976}],[{"start":{"row":99,"column":26},"end":{"row":99,"column":30},"action":"insert","lines":["すべての"],"id":977}],[{"start":{"row":99,"column":30},"end":{"row":99,"column":33},"action":"insert","lines":["情報を"],"id":978}],[{"start":{"row":99,"column":33},"end":{"row":99,"column":38},"action":"insert","lines":["入手できる"],"id":979},{"start":{"row":99,"column":38},"end":{"row":99,"column":39},"action":"insert","lines":["."]}],[{"start":{"row":99,"column":39},"end":{"row":100,"column":0},"action":"insert","lines":["",""],"id":980},{"start":{"row":100,"column":0},"end":{"row":100,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":100,"column":0},"end":{"row":100,"column":2},"action":"remove","lines":["  "],"id":981},{"start":{"row":99,"column":39},"end":{"row":100,"column":0},"action":"remove","lines":["",""]},{"start":{"row":99,"column":38},"end":{"row":99,"column":39},"action":"remove","lines":["."]}],[{"start":{"row":99,"column":38},"end":{"row":99,"column":39},"action":"insert","lines":["。"],"id":982}],[{"start":{"row":99,"column":39},"end":{"row":99,"column":40},"action":"insert","lines":["g"],"id":983},{"start":{"row":99,"column":40},"end":{"row":99,"column":41},"action":"insert","lines":["i"]},{"start":{"row":99,"column":41},"end":{"row":99,"column":42},"action":"insert","lines":["t"]}],[{"start":{"row":99,"column":42},"end":{"row":99,"column":43},"action":"insert","lines":[" "],"id":984}],[{"start":{"row":99,"column":42},"end":{"row":99,"column":43},"action":"remove","lines":[" "],"id":985},{"start":{"row":99,"column":41},"end":{"row":99,"column":42},"action":"remove","lines":["t"]},{"start":{"row":99,"column":40},"end":{"row":99,"column":41},"action":"remove","lines":["i"]},{"start":{"row":99,"column":39},"end":{"row":99,"column":40},"action":"remove","lines":["g"]}],[{"start":{"row":4,"column":11},"end":{"row":4,"column":39},"action":"remove","lines":[" (インターネットゲートウェイに向けてルートを設定する)"],"id":986,"ignore":true},{"start":{"row":7,"column":14},"end":{"row":7,"column":41},"action":"remove","lines":[" (SSH接続できるようインバウンドに22を許可する)"]},{"start":{"row":18,"column":39},"end":{"row":18,"column":82},"action":"remove","lines":["(デフォルトのローカル接続はそのままで,0.0.0.0/0でNATゲートウェイに接続)"]},{"start":{"row":18,"column":39},"end":{"row":19,"column":0},"action":"insert","lines":["",""]},{"start":{"row":26,"column":2},"end":{"row":102,"column":0},"action":"remove","lines":["ピアリング削除","5.VPC削除","","","◎VPCピアリング作成接続　（２つのVPC内のプライベートインスタンス同士の接続), Ping通信確認","0.接続先のVPC,サブネット、ルートテーブル,EC2作成","1.VPCピアリングを作成","  1.リクエスト側のVPCとその先のVPCを選択","  2.コンソール画面、ピアリングトップページでアクションから承諾を押す","2.リクエスト元と2つ目のVPC内にあるサブネットのルートテーブルをVPCピアリング(お互いのCIDRマスク)に向けるよう追加","3.3つ目のEC2のセキュリティグループのインバウンドにすべてのICMP iPv44を選択してPING通信をできるようにする.","4.１つ目のVPC内のプライベートEC2インスタンスから$ping (相手先のIPアドレス)でPingの確認ができる","","ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー","","AWS CLI インストール、設定方法 手順  Linux","$ curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"","$ curl -o awscliv2.sig https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip.sig(最新バージョン)","$ gpg --verify awscliv2.sig awscliv2.zip（署名検証)","$ unzip awscliv2.zip (zipフォルダ解凍)","$ sudo ./aws/install (インストールプログラム実行)","$ ./aws/install -i /usr/local/aws-cli -b /usr/local/bin (パスの指定)","$ aws --version (確認)","","$ AWS configure --profile ec2-user (設定) profileをつけることでユーザー名を追加できる。","AWS Access Key ID: IAM → ユーザー → 認証情報 → アクセスキー作成","AWS Secret Access Key:  IAM → ユーザー → 認証情報 → アクセスキー作成 ここで適当なユーザー情報を入れると権限がないのでコマンドを実行できない","Default region name: ap-northeast-1","Default output format: 記入なしでもOk. Jsonになる","profileでユーザーの情報を入れた後はcredentials, config内のデフォルト情報は消すようにする","","消した後はコマンドの末尾に --profile ec2-user(ユーザー名)をつけないと権限がないので見れない","",".awsのディレクトリの中config と credentialに AWS access key ID, AWS secret access keyregion, output formの設定ファイルがある","","AWS CLIコマンド","$ aws help コマンド確認 ","$ aws ec2 help  ec2関連のコマンド確認","","コマンドにdescribeがある場合詳細を見れるコマンド","$ aws ec2 describe-vpcs 現在あるvpcの情報","","後ろにつける--query Vpcs[].VpcId、vpcのid情報のみ出してくれる。[]に数字を入れると必要なものだけを出力できる。0一番上,1,2,3","","","----------------------------------------------","","S3エンドポイント (プライベートec2インスタンスからS3に接続)","1.プライベートec2インスタンスにNATゲートウェイでインターネット接続してAWS CLIコマンドインストール","2.S3エンドポイント作成","  1.VPC選択","  2.s3検索してゲートウェイタイプを選択","  3.プライベートサブネットに使っているルートテーブルを選択","  ","----------------------------------------------","","VPC CloudWatch Flow logs作成手順","","1.IAMから空のロールを作成","  とりあえずAWSのサービス,EC2にチェックして,許可ポリシーは選ばないで空のロールを作成する。","2.先ほど作成したロールを選んでポリシーを追加する。","  1.許可を追加からインラインポリシーを作成を選ぶ","  2.jsonからデフォルトのjsonで記述しているものを削除して公式のVPCフローログのロールのjsonをコピーしてペーストして作成を完了する。","  公式URL: https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/flow-logs-cwl.html","3.ロールの信頼関係の編集","  1.信頼ポリシーを編集","  2.公式のjsonから引っ張てくる。（principalのserviceの部分をec2からvpcが記述されているものに変更する。)","  3.更新ボタンを押す","4.CloudWatchロググループを作成","  保持期間が長いと、料金が高くなる。","5.VPCからフローログを作成","  - フィルタ..承諾されたトラフィックのみ保管か（失敗のみか、両方保管か)","  - CloudWatch Logsに送信","  - 先ほど作ったロググループとIAMロールを選択","  - ログ形式はカスタムから属性すべてを選択するとすべての情報を入手できる。","  ",""]},{"start":{"row":26,"column":2},"end":{"row":26,"column":7},"action":"insert","lines":["VPC削除"]}],[{"start":{"row":4,"column":11},"end":{"row":4,"column":39},"action":"insert","lines":[" (インターネットゲートウェイに向けてルートを設定する)"],"id":987,"ignore":true},{"start":{"row":7,"column":14},"end":{"row":7,"column":41},"action":"insert","lines":[" (SSH接続できるようインバウンドに22を許可する)"]},{"start":{"row":18,"column":39},"end":{"row":18,"column":82},"action":"insert","lines":["(デフォルトのローカル接続はそのままで,0.0.0.0/0でNATゲートウェイに接続)"]},{"start":{"row":21,"column":0},"end":{"row":22,"column":0},"action":"remove","lines":["",""]},{"start":{"row":25,"column":2},"end":{"row":25,"column":7},"action":"remove","lines":["VPC削除"]},{"start":{"row":25,"column":2},"end":{"row":101,"column":0},"action":"insert","lines":["ピアリング削除","5.VPC削除","","","◎VPCピアリング作成接続　（２つのVPC内のプライベートインスタンス同士の接続), Ping通信確認","0.接続先のVPC,サブネット、ルートテーブル,EC2作成","1.VPCピアリングを作成","  1.リクエスト側のVPCとその先のVPCを選択","  2.コンソール画面、ピアリングトップページでアクションから承諾を押す","2.リクエスト元と2つ目のVPC内にあるサブネットのルートテーブルをVPCピアリング(お互いのCIDRマスク)に向けるよう追加","3.3つ目のEC2のセキュリティグループのインバウンドにすべてのICMP iPv44を選択してPING通信をできるようにする.","4.１つ目のVPC内のプライベートEC2インスタンスから$ping (相手先のIPアドレス)でPingの確認ができる","","ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー","","AWS CLI インストール、設定方法 手順  Linux","$ curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"","$ curl -o awscliv2.sig https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip.sig(最新バージョン)","$ gpg --verify awscliv2.sig awscliv2.zip（署名検証)","$ unzip awscliv2.zip (zipフォルダ解凍)","$ sudo ./aws/install (インストールプログラム実行)","$ ./aws/install -i /usr/local/aws-cli -b /usr/local/bin (パスの指定)","$ aws --version (確認)","","$ AWS configure --profile ec2-user (設定) profileをつけることでユーザー名を追加できる。","AWS Access Key ID: IAM → ユーザー → 認証情報 → アクセスキー作成","AWS Secret Access Key:  IAM → ユーザー → 認証情報 → アクセスキー作成 ここで適当なユーザー情報を入れると権限がないのでコマンドを実行できない","Default region name: ap-northeast-1","Default output format: 記入なしでもOk. Jsonになる","profileでユーザーの情報を入れた後はcredentials, config内のデフォルト情報は消すようにする","","消した後はコマンドの末尾に --profile ec2-user(ユーザー名)をつけないと権限がないので見れない","",".awsのディレクトリの中config と credentialに AWS access key ID, AWS secret access keyregion, output formの設定ファイルがある","","AWS CLIコマンド","$ aws help コマンド確認 ","$ aws ec2 help  ec2関連のコマンド確認","","コマンドにdescribeがある場合詳細を見れるコマンド","$ aws ec2 describe-vpcs 現在あるvpcの情報","","後ろにつける--query Vpcs[].VpcId、vpcのid情報のみ出してくれる。[]に数字を入れると必要なものだけを出力できる。0一番上,1,2,3","","","----------------------------------------------","","S3エンドポイント (プライベートec2インスタンスからS3に接続)","1.プライベートec2インスタンスにNATゲートウェイでインターネット接続してAWS CLIコマンドインストール","2.S3エンドポイント作成","  1.VPC選択","  2.s3検索してゲートウェイタイプを選択","  3.プライベートサブネットに使っているルートテーブルを選択","  ","----------------------------------------------","","VPC CloudWatch Flow logs作成手順","","1.IAMから空のロールを作成","  とりあえずAWSのサービス,EC2にチェックして,許可ポリシーは選ばないで空のロールを作成する。","2.先ほど作成したロールを選んでポリシーを追加する。","  1.許可を追加からインラインポリシーを作成を選ぶ","  2.jsonからデフォルトのjsonで記述しているものを削除して公式のVPCフローログのロールのjsonをコピーしてペーストして作成を完了する。","  公式URL: https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/flow-logs-cwl.html","3.ロールの信頼関係の編集","  1.信頼ポリシーを編集","  2.公式のjsonから引っ張てくる。（principalのserviceの部分をec2からvpcが記述されているものに変更する。)","  3.更新ボタンを押す","4.CloudWatchロググループを作成","  保持期間が長いと、料金が高くなる。","5.VPCからフローログを作成","  - フィルタ..承諾されたトラフィックのみ保管か（失敗のみか、両方保管か)","  - CloudWatch Logsに送信","  - 先ほど作ったロググループとIAMロールを選択","  - ログ形式はカスタムから属性すべてを選択するとすべての情報を入手できる。","  ",""]}],[{"start":{"row":25,"column":1},"end":{"row":25,"column":2},"action":"remove","lines":["."],"id":988},{"start":{"row":25,"column":0},"end":{"row":25,"column":1},"action":"remove","lines":["4"]}]]},"ace":{"folds":[],"scrolltop":1180.5,"scrollleft":0,"selection":{"start":{"row":25,"column":0},"end":{"row":25,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":89,"state":"start","mode":"ace/mode/text"}},"timestamp":1664294578984}